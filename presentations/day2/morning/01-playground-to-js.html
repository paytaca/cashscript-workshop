<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>From Playground to JS - Day 2</title>
    <link rel="stylesheet" href="/node_modules/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="/node_modules/reveal.js/dist/theme/league.css">
    <link rel="stylesheet" href="/node_modules/reveal.js/plugin/highlight/monokai.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <div>
                    <h1 class="flex items-center justify-center gap-3 mb-4">
                        <p>
                            From <span class="text-green-500">Playground</span> to <span class="text-yellow-300">JavaScript</span>
                        </p>
                    </h1>
                    <h3 class="text-2xl mb-2">Day 2 - Morning Session</h3>
                    <p class="text-lg">
                        Moving out from CashScript Playground to JavaScript
                    </p>
                </div>
            </section>

            <section>
                <section data-auto-animate>
                    <div>
                        <pre><code class="language-javascript" data-line-numbers="1-7">pragma cashscript ^0.11.0;
    
contract Password (string password) {
    function spend (string inputPassword) {
        require(inputPassword == password);
    }
}
                        </code></pre>
                        <h3 class="fragment fade-up">What's next?</h3>
                    </div>
                </section>
            </section>

            <section>
                <h2>
                    <p>Moving <span class="text-green-500">CashScript</span> Outside</p>
                </h2>
            </section>

            <section>
                <section data-auto-animate>
                    <h2>Compiler</h2>
                    <pre><code class="language-bash">   npm install cashc</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>
                                for compiling CashScript <code class="text-green-500 font-bold">.cash</code>
                                files into <code class="text-yellow-300 font-bold">.json</code> /
                                <code class="text-blue-400 font-bold">.ts</code> files
                            </li>
                            <li>then used to instantiate the contract using the CashScript SDK</li>
                        </ul>
                    </div>
                </section>
    
                <section data-auto-animate>
                    <h2>Compiler</h2>
                    <p>Command Line Interface (CLI)</p>
                    <pre><code class="language-bash">    cashc [source_file] [options]
    cashc ./Contract.cash
    cashc ./Contract.cash --output ./artifact.json</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>displays/creates an artifact of the CashScript <code class="text-green-500">.cash</code> file</li>
                            <li>recommended method to compile artifact files</li>
                        </ul>
                    </div>
                </section>
    
                <section data-auto-animate>
                    <h2>Compiler</h2>
                    <p>JavaScript Compilation (from <code class="text-yellow-300">cashc</code> package)</p>
                    <ul class="space-y-2">
                        <li><p>
                            compiles a <span class="text-green-500">contract</span> into an
                            <span class="text-yellow-300">artifact</span> on the fly within <span class="text-yellow-300">JS</span>
                        </p></li>
                    </ul>
                </section>
    
                <section data-auto-animate>
                    <h2>Compiler</h2>
                    <p>JavaScript Compilation (from <code class="text-yellow-300">cashc</code> package)</p>
                    <pre><code class="language-javascript">     compileFile(sourceFile: PathLike): Artifact</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>compiles a contract from a source file</li>
                            <li>handy when using Node.js with the contract file locally available</li>
                        </ul>
                    </div>
                </section>
    
                <section data-auto-animate>
                    <h2>Compiler</h2>
                    <p>JavaScript Compilation (from <code class="text-yellow-300">cashc</code> package)</p>
                    <pre><code class="language-javascript">     compileString(sourceCode: string): Artifact</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>compiles a contract from a source code string</li>
                            <li>useful for quick compilation and discarding, and when source code is not locally available</li>
                        </ul>
                    </div>
                </section>
            </section>

            <section>
                <h3>Activity: Create Faucet artifact file using CLI</h3>
                <ol class="space-y-2 text-3xl">
                    <li>Open CLI and navigate to:</li>
                    <code class="text-purple-400 font-bold">quasar-apps/bch-faucet-ui/src/contracts</code>
                    <li>Run <pre style="width: 100% !important;"><code class="language-bash">   cashc ./Faucet.cash</code></pre></li>
                    <li class="fragment">Run <pre style="width: 100% !important;"><code class="language-bash">   cashc ./Faucet.cash --output ./faucet.json</code></pre></li>
                </ol>
            </section>

            <section>
                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <pre><code class="language-javascript" data-line-numbers="1-8">new Contract(
    artifact: Artifact,
    constructorArgs: ConstructorArgument[],
    options? : {
        provider: NetworkProvider,
        addressType: 'p2sh20' | 'p2sh32',
    }
)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        creates a new Contract from given parameters
                    </div>
                </section>
    
                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <pre><code class="language-javascript" data-line-numbers="2">new Contract(
    artifact: Artifact,
    constructorArgs: ConstructorArgument[],
    options? : {
        provider: NetworkProvider,
        addressType: 'p2sh20' | 'p2sh32',
    }
)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        an Artifact file either generated from CLI or compiled in JS
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <pre><code class="language-javascript" data-line-numbers="3">new Contract(
    artifact: Artifact,
    constructorArgs: ConstructorArgument[],
    options? : {
        provider: NetworkProvider,
        addressType: 'p2sh20' | 'p2sh32',
    }
)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        values to be used as parameters as stated in the contract
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <pre><code class="language-javascript" data-line-numbers="5">new Contract(
    artifact: Artifact,
    constructorArgs: ConstructorArgument[],
    options? : {
        provider: NetworkProvider,
        addressType: 'p2sh20' | 'p2sh32',
    }
)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        network where the CashScript SDK will connect to
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <h3>Network Providers</h3>
                    <pre><code class="language-javascript">new ElectrumNetworkProvider(network?: Network, options?: Options)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2 text-2xl">
                            <li>network: <code>'mainnet' | 'chipnet' | 'testnet3' | 'testnet4'</code></li>
                            <li>options: for specifying custom electrum client or hostname, and enable manual connection management</li>
                        </ul>
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <h3>Network Providers</h3>
                    <pre><code class="language-javascript">new MockNetworkProvider(options?: { updateUtxoSet: boolean })</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2 text-2xl">
                            <li>evaluate transactions locally without interacting with the BCH network</li>
                            <li>useful for testing (manual or automated)</li>
                            <li>UTXOs can be generated randomly or with a custom one</li>
                            <li><code>updateUtxoSet</code> - determine whether the UTXOs should be updated after a transaction is sent</li>
                        </ul>
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Contract Instantiation</h2>
                    <pre><code class="language-javascript" data-line-numbers="6">new Contract(
    artifact: Artifact,
    constructorArgs: ConstructorArgument[],
    options? : {
        provider: NetworkProvider,
        addressType: 'p2sh20' | 'p2sh32',
    }
)</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        the resulting address type of the contract
                    </div>
                </section>
            </section>

            <section>
                <h3>Activity: Instantiate Faucet contract</h3>
                <ol class="space-y-2 text-3xl">
                    <li>Under the same directory, open <code class="text-yellow-300 font-bold">faucet-instantiate.js</code></li>
                    <li>Adjust the values in the <code class="text-purple-400 font-bold">contractArgs</code> variable (or keep them)</li>
                    <li>Console log <code class="text-purple-400 font-bold">contract</code> variable</li>
                    <li>Open CLI and run <pre><code class="language-bash">node password.js</code></pre></li>
                </ol>
            </section>

            <section>
                <section data-auto-animate>
                    <h2>Transaction Builder</h2>
                    <pre><code class="language-javascript">new TransactionBuilder(options: { provider: NetworkProvider })</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>tool for constructing transactions that will determine how the funds inside the contract is spent</li>
                        </ul>
                    </div>
                </section>

                <section data-auto-animate>
                    <h2>Transaction Builder</h2>
                    <ul class="space-y-2 text-4xl">
                        <li>
                            <span>
                                basic transactions include adding <span class="text-yellow-300 font-bold">input(s)</span>
                                and <span class="text-yellow-300 font-bold">output(s)</span>
                            </span>
                            <ul class="space-y-2">
                                <li class="fragment">input - the current UTXOs of the contract + <span class="text-yellow-300 font-bold">unlocker</span></li>
                                <li class="fragment">output - dictates where the funds are sent</li>
                            </ul>
                        </li>
                        <li class="fragment">
                            unlockers
                            <ul class="space-y-2">
                                <li>the functions in the contract that does checks and runs rules before funds are sent</li>
                            </ul>
                        </li>
                    </ul>
                </section>
    
                <section data-auto-animate>
                    <h2>Transaction Builder</h2>
                    <ul class="space-y-2">
                        <li><code>addInput()</code></li>
                        <pre style="width: 100% !important;"><code class="language-javascript">transactionBuilder.addInput(
    utxo: Utxo,
    unlocker: Unlocker,
    options?: InputOptions
): this</code></pre>
                        <li><code>addInputs()</code></li>
                        <pre style="width: 100% !important;"><code class="language-javascript">transactionBuilder.addInputs(
    utxos: Utxo[],
    unlocker: Unlocker,
    options?: InputOptions
): this</code></pre>
                    </ul>
                </section>
    
                <section data-auto-animate>
                    <h2>Transaction Builder</h2>
                    <ul class="space-y-2">
                        <li><code>addOutput()</code></li>
                        <pre style="width: 100% !important;"><code class="language-javascript">transactionBuilder.addOutput(output: Output): this</code></pre>
                        <li><code>addOutputs()</code></li>
                        <pre style="width: 100% !important;"><code class="language-javascript">transactionBuilder.addOutputs(outputs: Output[]): this</code></pre>
                    </ul>
                </section>
    
                <section data-auto-animate>
                    <h2>Transaction Builder</h2>
                    <pre><code class="language-javascript">interface Output {
    to: string | Uint8Array; // address
    amount: bigint; // e.g. 12_345n (= 0.00012345 BCH)
    token?: {
        amount: bigint;
        category: string;
        nft?: {
            capability: 'none' | 'mutable' | 'minting';
            commitment: string;
        }
    }
}</code></pre>
                </section>
            </section>

            <section>
                <h3>Example: <code>faucet-transact.js</code></h3>
                <pre><code class="language-javascript">// set up network provider
const provider = new MockNetworkProvider()

// instantiate Transaction Builder
const transactionBuilder = new TransactionBuilder({ provider })

// get the utxos of the contract
const utxos = await faucetContract.getUtxos()

// declare the output
const outputs = [
  {
    to: 'bchtest:qzxu7zvdgquka95v83m6u8ywzrsdk4vah5wrmerdu0',
    amount: 5_000n
  },
  // change address (back to contract)
  {
    to: faucetContract.address,
    amount: 10_000n - 5_000n - 1100n
  }
]

// build the transaction 
const tx = transactionBuilder
  .addInputs(utxos, faucetContract.unlock.claim('123456'))
  .addOutputs(outputs)</code></pre>
            </section>

            <section>
                <section data-auto-animate>
                    <h3>Completing the Transaction</h3>
                    <code>send()</code>
                    <pre><code class="language-javascript" data-line-numbers="7">await transactionBuilder
    .addInputs(
        utxos,
        faucetContract.unlock.claim('123456')
    )
    .addOutputs(outputs)
    .send()</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>sends the transaction to the BCH network and returns the transaction details</li>
                            <li>incomplete transactions and failed rules will incur errors</li>
                        </ul>
                    </div>
                </section>
    
                <section data-auto-animate>
                    <h3>Completing the Transaction</h3>
                    <code>build()</code>
                    <pre><code class="language-javascript" data-line-numbers="7">transactionBuilder
    .addInputs(
        utxos,
        faucetContract.unlock.claim('123456')
    )
    .addOutputs(outputs)
    .build()</code></pre>
                    <div class="mt-4 p-4 bg-white/10 rounded-lg text-[30px]">
                        <ul class="space-y-2">
                            <li>builds the transaction and returns the signed transaction hex string (does not yet send)</li>
                            <li>can be imported into other applications or libraries for further use</li>
                        </ul>
                    </div>
                </section>
            </section>

            <section>
                <h3>Activity: Build a transaction</h3>
                <ol class="space-y-2 text-3xl">
                    <li>Under the same directory, open <code class="text-yellow-300 font-bold">password-transact.js</code></li>
                    <li>Add <code class="text-purple-400 font-bold">.build()</code> to the transaction being built</li>
                    <li>Console log the variable <code class="text-purple-400 font-bold">tx</code></li>
                    <li>Open CLI and run <pre><code class="language-bash">node password-transact.js</code></pre></li>
                    <li>
                        Go back to the file and replace <code class="text-purple-400 font-bold">.build()</code>
                        with <code class="text-purple-400 font-bold">.send()</code> and add
                        <code class="text-purple-400 font-bold">await</code> before
                        <code class="text-purple-400 font-bold">transactionBuilder</code>
                    </li>
                    <li>Run the command above again</li>
                </ol>
            </section>

            <section>
                <h2>More information</h2>
                <h3>Check out the <span class="text-green-500">CashScript</span> docs website</h3>
                <a href="https://cashscript.org/docs/basics/about" data-preview-link>
                    https://cashscript.org/docs/basics/about
                </a>
            </section>

            <section>
                <h2>Back to Main</h2>
                <p><a href="../../index.html">← Workshop Overview</a></p>
                <h3>OR</h3>
                <h2>Move to Next</h2>
                <p><a href="./02-quasar-framework.html">Quasar Framework →</a></p>
            </section>
        </div>
    </div>

    <script src="/node_modules/reveal.js/dist/reveal.js"></script>
    <script src="/node_modules/reveal.js/plugin/highlight/highlight.js"></script>
    <script>
        Reveal.initialize({
            hash: true,
            transition: 'fade',
            plugins: [RevealHighlight]
        });
    </script>
</body>
</html>